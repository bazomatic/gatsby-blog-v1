---
layout: post
title: Building the pipeline
date: 2020-01-26
comments: false
published: false
---

WILL IT BLEND?!

Setting up the pipeline has been easier than I expected, further reinforcing that I was 100% in the right to procrastinate on doing this as long as I did. I already had the site building and manually deploying, so following Joshua Walsh's guide and using the template from Greeshma Sindhe's tutorial, I think it took like 15 minutes at most to get the actual pipeline to trigger a build on commit to master, mostly because AWS CodeBuild and CodePipeline do all the heavy lifting off of a single buildspec.yml file. Nice!

The post-build (i.e. actual deployment to S3) failed on me because I'm pretty sure I failed to properly configure permissions to write to the S3 bucket. AWS docs indicated that despite the roles being autogenerated, and perhaps I missed it in the wizard, you still need to manually add the bucket arn and appropriate permissions to the role that CodeBuild will use. Which makes total sense.

Unfortunately I couldn't manually retry builds on my pipeline from the AWS console, so I pushed another commit to master, and voila! Failure. ü§¶‚Äç‚ôÇ Next attempt was to remove the s3 command in the buildspec.yml file since CodePipeline itself says it will drop the file into the bucket, and that...

## Shoutouts üéâ

üè´ Joshua Walsh's excellent tutorial [_'Gatsby on AWS, the right way'_](https://blog.joshwalsh.me/aws-gatsby/) for great insights into standing up CICD pipelines quickly on AWS, complete with a pre-prod environment

‚ÑπÔ∏è [Greeshma R. Sindhe](https://medium.com/@greeshu.renu/host-gatsby-js-site-on-amazon-s3-with-aws-codepipeline-675117686b9b) for a buildpsec.yml file template to pass into CodeBuild